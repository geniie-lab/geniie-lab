# Session Experiment

In the session experiment, researchers can examine the GII response of four search stages such as querying, clicking, relevance judgement, and query reformulation. A session can be configured as simple as a single stage of `{query}` to as complex as six (or more) sequence of stages like `{query, ranking, clicking, relevance judgement, reformulating, ranking}`.

See [Common Settings](common_settings.md) first to learn the overall experimental settings.

## Plan

A plan is a set of search stages to be executed as a single session.

- `query`: Initial query formulationg
- `ranking`: Retrieval using the formulated query
- `click`: Document selection from the SERP of retrieved documents
- `relevance`: Relevance judgements of the fulltext of clicked documents.
- `reformulate`: Query reformulation based on the search history

```
my_settings = ExperimentSettings(
    name="my_session_experiment",
    ...
    plan=["query", "ranking", "click", "relevance", "reformulate", "ranking"]
    ...
)
```

### How to organise the plan

If you're interested in quey formulation stage:

```
plan=["query"]
```

If you're interested in clicking stage on the serp generated by the formulated query:

```
plan=["query", "ranking", "click"]
```

If you're intested in up to ranking stage of reformulated queries:

```
plan=["query", "ranking", "click", "relevance", "reformulate", "ranking"]
```

### How not to organise the plan

There are several depenencies in the `plan`.
- `ranking` requires `query` or `reformulate`
- `relevance` requires `click`
- `click` requires `ranking`

```
plan=["ranking"] # No query
plan=["query", "click", "relevance"] # No ranking
plan=["query", "ranking", "relevance"] # No click
```

## Sample output

- `model`: `gpt-4.1-mini`
- `dataset`: `quaint/trec-robust-2005`
- `ranking_model`: `bm25`
- `plan`: `["query", "ranking", "click", "relevance", "reformulate", "ranking"]`

```
{"session_name": "my_session_experiment", "model": "gpt-4.1-mini", "task": "High-Precision Retrieval", "dataset": "aquaint/trec-robust-2005", "topic_id": "303", "query": "Hubble telescope achievements discoveries new data increased knowledge universe disproved theories", "start": 0, "size": 10, "repetition": 1, "reason": null, "stage": "query", "created_at": "2025-07-02T04:40:03.600086+00:00"}
{"session_name": "my_session_experiment", "model": "gpt-4.1-mini", "ranker": "bm25", "task": "High-Precision Retrieval", "dataset": "aquaint/trec-robust-2005", "topic_id": "303", "doc_ids": ["APW19990108.0103", ..., "APW19990516.0013"], "start": 0, "size": 10, "performance": {"RR@10": 1.0, "nDCG@10": 0.536444579997845}, "repetition": 1, "stage": "ranking", "created_at": "2025-07-02T04:40:03.723073+00:00"}
{"session_name": "my_session_experiment", "model": "gpt-4.1-mini", "task": "High-Precision Retrieval", "dataset": "aquaint/trec-robust-2005", "topic_id": "303", "rankings": [1, 2, 4, 8], "repetition": 1, "reason": null, "stage": "click", "created_at": "2025-07-02T04:40:04.583401+00:00"}
{"session_name": "my_session_experiment", "model": "gpt-4.1-mini", "task": "High-Precision Retrieval", "dataset": "aquaint/trec-robust-2005", "topic_id": "303", "docid": "APW19990108.0103", "label": "Relevance.RELEVANT", "qrel_label": 2, "repetition": 1, "stage": "rel_judge", "created_at": "2025-07-02T04:40:05.329836+00:00"}
...
{"session_name": "my_session_experiment", "model": "gpt-4.1-mini", "task": "High-Precision Retrieval", "dataset": "aquaint/trec-robust-2005", "topic_id": "303", "query": "Hubble telescope scientific discoveries new data increased knowledge universe disproved hypotheses", "start": 0, "size": 10, "repetition": 1, "reason": null, "stage": "reformulation", "created_at": "2025-07-02T04:40:08.610535+00:00"}
{"session_name": "my_session_experiment", "model": "gpt-4.1-mini", "ranker": "bm25", "task": "High-Precision Retrieval", "dataset": "aquaint/trec-robust-2005", "topic_id": "303", "doc_ids": ["APW19990108.0103", ..., "NYT19991215.0229"], "start": 0, "size": 10, "performance": {"RR@10": 1.0, "nDCG@10": 0.6726934039987301}, "repetition": 1, "stage": "ranking", "created_at": "2025-07-02T04:40:08.784302+00:00"}
```